<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
 <mapper namespace="tblproduct">
 	<!-- 동적쿼리 : 상품 조회에 검색 필터 적용. 4가지 경우 중 하나의 쿼리가 실행되게 할 수 있습니다
 		 - 마이바티스 동적쿼리에 사용되는 태그
 		 	: where, if, trim 
 		 결과 쿼리 예시:
 		 select * from tbl_product where category = 'B2' and pname like '%' || '사과' || '%'
 	 -->
 	<select id="search" resultType="ProductDto" parameterType="java.util.Map">
 		select 	pcode, 
 				category, 
 				pname, 
 				price
 		from tbl_product
 		<where>
 			<!--  if 태그 test 속성 값은 조건식을 작성합니다.
 				  parameter 인 keyword 의 값이 있는 경우를 체크합니다
 			 --> 
 			<if test="keyword!=null">
 				pname like '%' || #{keyword} || '%'
 			</if>
 			
 			<if test="category!=null">
 				<!-- 앞에 조건식이(prefix) 없는 경우 and를 제거(trim)하고
 					앞에 조건식이 있는 경우만 and를 붙인다  -->
 				
 				<trim prefix ="and">
 					category = #{category}
 				</trim>
 			</if>
 			
 			<!-- 논리연산자 and or -->
 			<if test="from!=null and to!=null">
 				<trim prefix ="and">
 					price between #{from} and #{to}
 				</trim>
 			</if>
 		</where>
 		<if test="column!=null">
 		<!-- #{} : ""안에 들어가는 값이라고 생각하면 됨
 			 ${} : 자바로 전달한 값 그대로 들어간다고 생각하면 됨 (""없이)
 		 -->
 		order by ${column}
 		</if>
 	</select>
 	
 	<select id="getCategories" resultType="CateDto">
 		<!-- SELECT distinct category FROM TBL_PRODUCT
 		order by category -->
 		select code, name from tbl_category order by code
 	</select>
 	 
 	<select id="selectAll" resultType="ProductDto">
 		SELECT pcode, category, pname, price
		FROM TBL_PRODUCT tp 
		ORDER BY pcode
  	</select>
  	
  	<select id="selectByPname" parameterType="String" resultType="ProductDto">
 		SELECT pcode, category, pname, price
		FROM TBL_PRODUCT  
		WHERE pname LIKE '%' || #{pname} || '%' 
  	</select>

  	<select id="selectByCategory" parameterType="String" resultType="ProductDto">
 		SELECT pcode, category, pname, price
		FROM TBL_PRODUCT  
		WHERE category LIKE '%' || #{category} || '%' 
		order by pname
  	</select>
  	
 	<!-- insert, update, delete 는 리턴타입 지정안합니다(그래도 값은 리턴해줍니다) -->
 	<insert id="insert" parameterType="ProductDto">
 		insert into tbl_product(pcode, category, pname, price)
    							values(#{pcode}, #{category}, #{pname}, #{price})
 	</insert>
 	
 	<update id="update" parameterType="java.util.Map">
 		update tbl_product
 			set pname = #{pname}
 			where pcode = #{pcode}
 	</update>
 	
 	<delete id="delete" parameterType="String">
 		delete tbl_product where pcode = #{pcode}
 	</delete>
 	

 	
 </mapper>
 
 